var App=App||{};App.ProductLister=App.ProductLister||{},App.ProductLister.LazyLoadImages=new function(){var a,b=Salmon.Global.FeatureToggles.getFeature("NewPLP"),c=b?$("#productContainer .product .productHeader img"):$(".productItem .imageHolder .photo img"),d=$(window),e=d.height(),f=$(".productHeader a").height(),g=$(".productHeader a").width(),h=function(b){return b.offset().top<a+200},i=function(a){a.attr("src",a.data("src")),a.on("load",function(){if(this.naturalWidth>this.naturalHeight){var a=this.naturalHeight/this.naturalWidth;g*a>=f||this.width<g?$(this).css("width","70%").css("height","auto"):$(this).addClass("horizontal")}else this.naturalHeight<f&&$(this).css("height","90%")}),a.css("visibility","visible")},j=function(){a=e+d.scrollTop(),c.each(function(){var a=$(this);h(a)&&""===a.attr("src")&&i(a)})},k=function(){c=b?$("#productContainer .product .productHeader img"):$(".productItem .imageHolder .photo img"),j()};return c.length>0&&(j(),$(window).scroll(j)),{loadNewImages:k}};var App=App||{};App.ProductLister=App.ProductLister||{},App.ProductLister.List=new function(){function a(){b(),c()}function b(){var a=$("#productLister");0!==a.length&&new Salmon.Global.Truncator(a.find(Configuration.ProductLister.Truncator.node),Configuration.ProductLister.Truncator)}function c(){var a=$("#featuredProducts");0!==a.length&&new Salmon.Global.Truncator(a.find(Configuration.ProductLister.Truncator.node),Configuration.ProductLister.Truncator)}$(a)},App.ProductLister.List.Ratings=new function(){function a(){var a=$("li.review").removeClass("hide");new App.Global.Ratings(a)}$(a)},App.ProductLister.List.MissedPromotions=new function(){function a(){document.body.className.indexOf("missedPromotion")>=0&&document.getElementById("applied")&&$(document).bind(Salmon.Global.CustomEvents.customProductAddedToBasket,function(a,b){if(b.missedPromotionHeaderHtml&&""!==b.missedPromotionHeaderHtml){$(document.getElementById("applied")).replaceWith($(b.missedPromotionHeaderHtml));try{Cufon.replace("#pgProductLister h1",{fontFamily:"CBJWT37"})}catch(c){console.log("error in ProductLister.List @ line 47"),console.log(c)}}})}$(a)},App.ProductLister.List.productView=function(){function a(){console.log("logging: list68");var a=new App.Global.StorageHandler,b=a.check(),c=$("#productLister .products"),d=document.getElementById("galleryView")||null,e=document.getElementById("listView")||null,f=window.innerWidth>0?window.innerWidth:screen.width;b&&(d&&e&&("galleryView"==a.get("productView")?($(c).removeClass("listView").addClass("galleryView"),d.checked=!0,e.checked=!1):"listView"==a.get("productView")&&($(c).removeClass("galleryView").addClass("listView"),d.checked=!1,e.checked=!0)),null===a.get("productView")&&(f<650?($(c).removeClass("galleryView").addClass("listView"),d.checked=!1,e.checked=!0):($(c).removeClass("listView").addClass("galleryView"),e.checked=!1,d.checked=!0)))}$(a)},App.ProductLister.NewPLPFunctions=function(){function a(){var a=0,b=function(){for(var b,c=/\+/g,d=/([^&=]+)=?([^&]*)/g,e=function(a){return decodeURIComponent(a.replace(c," "))},f=window.location.search.substring(1),g={};b==d.exec(f);)e(b[1]).indexOf("attributeName")!=-1&&a++,g[e(b[1])]=e(b[2]);return g},c=function(a,b){return a?void(window.location.search="?"+$.param(b)):window.location.origin+window.location.pathname+"?"+$.param(b)+"&pageMode=true"},d=function(){var a=b();for(var d in a)d.indexOf("attributeName")==-1&&d.indexOf("attributeValue")==-1&&d.indexOf("provenance")==-1||delete a[d];a.inStockOnly="true",c(!0,a)};$("#sidebar .applied h2 a").on("click",function(a){a.preventDefault(),Salmon.Global.uiBlocker.insertLoader($("main")),d()})}function b(){var a=$("#inStockFilters form"),b=a.find("#showOutOfStockProducts"),c=a.find('input[name="inStockOnly"]');b.on("change",function(){Salmon.Global.uiBlocker.insertLoader($("main")),b.is(":checked")?c.val("false"):c.val("true"),a.submit()})}function c(){if($("body").hasClass("category")){var a=$(".plpHeader .categoriesLinks");a.length>0&&(a.clone().prependTo("aside"),a.remove())}}var d=$("#productContainer"),e=d.find("article").eq(0).width(),f=function(){var a=$("#productContainer .product"),b=a.length,c=d.width(),f=parseInt(c/e,10),g=Math.ceil(b/f)*f-b,h="";d.find(".shadow").remove();for(var i=0;i<g;i++)h+='<div class="shadow"></div>';d.append(h)};f(),$(window).on("resize.productAdjust newProductsAdded",f),$.fn.slideToggleSection=function(a){var b=this.parent();if(this.hasClass("trigger"))var c=this.siblings(".content").length>1?this.next():this.siblings(".content");else var c=this.find(".content").length>1?this.next():this.find(".content");c.slideToggle(function(){a&&a()}),b.toggleClass("collapsed")},$(document).on("click",".collapsible > .trigger",function(){$(this).slideToggleSection()}),$(document).on("click",".filterDisplayToggle",function(){$("#plp.content").toggleClass("hideFilters"),$(this).html("Show refine options"==$(this).text()?"Hide refine options":"Show refine options")}),b(),a(),c()},Salmon.Global.FeatureToggles.getFeature("NewPLP")?App.ProductLister.NewPLPFunctions():App.ProductLister.List.productView();var App=App||{};App.ProductLister=App.ProductLister||{},App.ProductLister.Recommendations=function(){$(document).ready(function(){var a=$("#masterCategory").text(),b={zoneId:"Cat_1",categoryId:a};IO_getRecommendations([b])})},Salmon.Global.FeatureToggles.getFeature("NewPLP")||App.ProductLister.Recommendations(),App.ProductLister.MiniBasketRecommendations=function(a){var b={zoneId:"MBask_1",productId:a,allowBuy:!0};IO_getRecommendations([b])};var App=App||{};App.ProductLister=App.ProductLister||{},App.ProductLister.SortBy=new function(){function a(){function a(){$(this).parents("form").trigger("submit"),Salmon.Global.FeatureToggles.getFeature("NewPLP")&&Salmon.Global.uiBlocker.insertLoader($("main"))}$root=Salmon.Global.FeatureToggles.getFeature("NewPLP")?$(".plpHeader .sort"):$("#productLister div.sortBy"),$form=$root.find("form"),$root.find('input[type="submit"]').remove(),$root.find("select").bind("change",a),$.browser.msie&&parseInt($.browser.version,10)<8&&$root.find("select").bind("mousedown",function(){$root.addClass("focus")}).bind("blur",function(){$root.removeClass("focus")})}$(a),Salmon.Global.FeatureToggles.getFeature("NewPLP")&&$("#sidebar > div a").on("click",function(){Salmon.Global.uiBlocker.insertLoader($("main"))})};var App=App||{};App.ProductLister=App.ProductLister||{},App.ProductLister.TopTen=new function(){function a(a){var b=$(a).find("div.clip");b.append("<span class='leftPointer' /><span class='rightPointer' />")}$(function(){if(document.getElementById("charts")){var b=$("#charts").addClass("roller"),c=b.find("div.productTopTen"),d=c.find("span.title");new Salmon.Global.Truncator(d,Configuration.ProductLister.TopTen);for(var e=0;e<c.length;e++)new Salmon.Components.Roller(c[e],{itemsPerRow:1===c.length?4:1}),a(c[e])}else for(var c=$("div.productTopTen","#primary"),e=0;e<c.length;e++)new App.ProductLister.TopTen.Expander(c[e],Configuration.ProductLister.TopTen.expanderOptions),Configuration.ProductLister.TopTen.truncator&&(console.log("logging: tt25"),new Salmon.Global.Truncator(c.find(Configuration.ProductLister.TopTen.truncator.node),Configuration.ProductLister.TopTen.truncator))})},App.ProductLister.TopTen.Expander=function(a,b){function c(){e.css("height",h),f.bind("click",function(){return e.animate({height:i?h+"px":g+"px"},"slow"),f.removeClass("open").addClass(i?"":"open"),i=!i,!1}),d.prepend(f)}var d=$(a),e=d.find("div.clip"),f=$(document.createElement("a")).addClass("expand").attr("href","#none").text("Expand chart"),g=e.height(),h=b.height?b.height:e.find("li:first").outerHeight(),i=!1;c()},App=App||{},App.SearchResults=App.SearchResults||{},App.SearchResults.pagination=new function(){var a,b=0===$("ul.products").length&&1===$("ul.articles").length,c=function(){"undefined"!=typeof window.history&&"undefined"!=typeof window.history.state&&null!==window.history.state&&$(window).scrollTop(window.history.state.scrollTop)},d=function(a){var b=a.split("?")[1].split("&"),c={};return b.forEach(function(a){a=a.split("="),c[a[0]]=decodeURIComponent(a[1]||"")}),c},e="undefined"!=typeof window.history&&"undefined"!=typeof window.history.state&&null!==window.history.state&&"undefined"!=typeof window.history.state.newProducts&&0!==window.history.state.newProducts.length,f=e&&"undefined"!=typeof window.history.state.pageNumber?window.history.state.pageNumber:2,g=e?window.history.state.newProducts:"",h=0,i=!1,j=Salmon.Global.FeatureToggles.getFeature("NewPLP"),k=function(c,e,k,l,m,n){console.log("logging: pg37");var o=c.split("?")[0],p=d(c);$(".loaderLeft").addClass("loading"),$(".loaderRight").addClass("loading"),p.pageMode=!0,p.pageNumber=f;var q=p.searchTerm;o=o+"?searchTerm="+q,o=o.replace("http://","//"),delete p.searchTerm,i=!0,$.ajax({type:"GET",data:p,url:o,success:function(c,d,o){var p=document.createElement("div"),q=$(p);if(p.innerHTML=c,b)var r=q.find("#productLister > ul.articles > .articleItem").length>0?q.find("#productLister > ul.articles > .articleItem"):$(p).find(".articleItem");else var r=q.find("#productLister > ul.products > .productItem").length>0?q.find("#productLister > ul.products > .productItem"):$(p).find(".productItem");j&&(r=q.find("article.product"),$("#productContainer").find(".shadow").remove());for(var s=0;s<r.length;s++)b?$("#productLister > .articles")[0].appendChild(r[s]):j?$("#productContainer")[0].appendChild(r[s]):$("#productLister > .products")[0].appendChild(r[s]),g+=r[s].outerHTML;$("div.next").replaceWith(q.find(".next")),new Salmon.Global.Truncator($("#productLister").find("div.fn"),null);var t=new App.Global.PlatformImages;t.setUpImages(document.getElementById("productLister")),$(".loaderLeft").removeClass("loading"),$(".loaderRight").removeClass("loading"),App.ProductLister.LazyLoadImages.loadNewImages(),""===l&&(l=null),""===m&&(m=null),cmCreatePageviewTag(e,k,l,m,"10151",n),h++,f++,i=!1,j&&($(window).trigger("newProductsAdded"),Salmon.Global.uiBlocker.removeLoader($("#productContainer")),a=$("#productContainer").offset().top+$("#productContainer").height(),0===r.length&&$(window).off("scroll.preloadProducts"))},error:function(a){console.log(a)}})};if(window.onbeforeunload=function(){history.pushState({scrollTop:$(window).scrollTop(),pageNumber:f,newProducts:g},"Page "+h,"#Page"+f)},g.length>0&&$(document).ready(function(){b?$("#productLister >.articles").append(g):$("#productContainer").append(g),App.ProductLister.LazyLoadImages.loadNewImages(),c()}),j&&$(".pageControls a").length>0){var a=$("#productContainer").offset().top+$("#productContainer").height(),l=$(window),m=l.height(),n=$(".pageControls a");$(window).on("scroll.preloadProducts",function(){$(window).scrollTop()+m>a-200&&!i&&(n.trigger("click"),Salmon.Global.uiBlocker.insertLoader($("#productContainer"),"LOADING MORE PRODUCTS"))})}return{makeRequest:k}};
//# sourceMappingURL=plp.min.js.map