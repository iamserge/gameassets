function clearErrorSumary(){0===$("#reviewErrorSummary").find("ul").find("li").length&&($("#reviewErrorSummary").find("ul").remove(),$("#reviewErrorSummary").find("h4").remove(),$("#reviewErrorSummary").find("span").remove(),$("#reviewErrorSummary").addClass("errorSummary hide"))}var App=App||{};App.PDP=App.PDP||{},App.PDP.Bundle=App.PDP.Bundle||{},App.PDP.Bundle.Controller=new function(){var a=$(".section.buyingChoices.descContent"),b=$(".section.bundleContent .inner > div"),c=a.find(".tabLinks li"),d=a.find(".sections > div"),e="current",f=function(a){c.filter("."+e).removeClass(e),d.filter("."+e).removeClass(e),d.eq(a).addClass(e)};b.on("click",function(a){var d=$.inArray(this,b);a.preventDefault(),f(d),$(this).addClass(e),c.eq(d).addClass(e),$(window).trigger("resize")}),c.on("click",function(){var a=$.inArray(this,c);f(a),$(this).addClass(e),$(window).trigger("resize")})};var App=App||{};App.PDP=App.PDP||{},App.PDP.Bundlizer=new function(){function a(){var a=document.getElementById("priceInfo")||document.getElementById("variants")||null;if(a)for(var c=$("[id^='bundlizerListUpdate']").find("input[type='checkbox']"),d=0;d<c.length;d++)b(c[d])}function b(a){var b=$(a),c=b.siblings("input[type='submit']").hide();b.bind("click",function(){this.checked=!0,c.trigger("click")})}$(a)};var App=App||{};App.PDP=App.PDP||{},App.PDP.Carousel=function(){},App.PDP.Carousel.prototype.setUpCarousels=function(a){for(var b=0;b<a.length;b++){var c=a[b]||null;if(c){for(var d=0;d<c.children.length;d++)if(c.children[d].className.indexOf("clip")!=-1){var e=c.children[d];break}if(e){var f=e.firstElementChild||e.firstChild,g=f.children,h=0,i=$("#userReviews .pagination").width();$(f).css("left","40px");for(var d=0;d<g.length;d++){var j=g[d];this.getItemDims(j).itemWidth,this.getItemDims(j).itemPaddingLeft,this.getItemDims(j).itemPaddingRight,this.getItemDims(j).itemBorderLeft,this.getItemDims(j).itemBorderRight;$(j).css("width",i),h+=i+41}$(f).css({width:h+300,position:"relative"});var k=$(c).children(".pagination").find("a"),l=40,m=this;k.each(function(){$(this).bind("click",function(a){if(a.preventDefault(),this.parentNode.className.indexOf("disabled")==-1){var b=!1;h=m.getItemDims(f).itemWidth,this.parentNode.className.indexOf("previous")!=-1?l+=i+40:l-=i+40;var c=1e3;window.getComputedStyle?(window.getComputedStyle(f).transitionProperty||window.getComputedStyle(f).OTransitionProperty||window.getComputedStyle(f).WebkitTransitionProperty||window.getComputedStyle(f).MozTransitionProperty)&&(b=!0):f.currentStyle.transitionProperty&&(b=!0),b?(f.style.left=l+"px",f.style.WebkitTransitionProperty="left",f.style.WebkitTransitionDuration=c/1e3+"s",f.style.MozTransitionProperty="left",f.style.MozTransitionDuration=c/1e3+"s",f.style.transitionProperty="left",f.style.transitionDuration=c/1e3+"s"):$(f).animate({left:l},c);var d=k[0].parentNode,g=k[1].parentNode;console.log(parseInt(l,10)),parseInt(l,10)>=0?$(d).addClass("disabled"):$(d).removeClass("disabled");var j=m.getItemDims(f.children[f.children.length-1]).itemLeft,n=m.getItemDims(f.children[f.children.length-1]).itemWidth,o=m.getItemDims(e).itemRight;console.log(j),console.log(n),console.log(o),this.parentNode.className.indexOf("next")!=-1&&this.parentNode.className.indexOf("enabled")==-1&&j-n<o?$(g).addClass("disabled"):$(g).removeClass("disabled")}})})}}}},App.PDP.Carousel.prototype.addCarouselItem=function(a){console.log("addCarouselItem!");for(var b=0;b<a.children.length;b++)if(a.children[b].className.indexOf("clip")!=-1){var c=a.children[b];break}if(c){var d=c.firstElementChild||c.firstChild,e=d.children[d.children.length-1],f=d.children[d.children.length-2],g=this.getItemDims(d).itemWidth,h=this.getItemDims(f).itemPaddingLeft,i=this.getItemDims(f).itemPaddingRight,j=this.getItemDims(f).itemBorderLeft,k=this.getItemDims(f).itemBorderRight,l=this.getItemDims(f).itemWidth;g+=l,$(e).css("width",l-h-k-j-i),$(d).css("width",g)}},App.PDP.Carousel.prototype.getItemDims=function(a){var b=a.getBoundingClientRect(),c=parseFloat($(a).css("paddingLeft"))||0,d=parseFloat($(a).css("paddingRight"))||0,e=parseInt($(a).css("borderLeftWidth"),10)||0,f=parseInt($(a).css("borderRightWidth"),10)||0,g=b.left,h=b.right,i=h-g;return{itemLeft:g,itemRight:h,itemWidth:i,itemPaddingLeft:c,itemPaddingRight:d,itemBorderLeft:e,itemBorderRight:f}};var App=App||{};App.PDP=App.PDP||{},App.PDP.FormatSelect=new function(){$(document).ready(function(){var a=$(".panelContainer .format ");a.length>0&&(a.find(".selected").on("click",function(){a.parent().find(".dropdown").slideToggle()}),a.find(".dropdown li").on("click",function(){var a=$(this).data("url");"undefined"!=typeof a&&(Salmon.Global.uiBlocker.blockUI(),window.location.href=a)}))})},App.PDP.Ratings=new function(){new App.Global.Ratings($("#rating, #detailsRating, #secondary div.productCrossSells li.review"))},App.PDP.ReviewRatings=new function(){$(document).ready(function(){var a=$("<p>").addClass("label"),b=$("#ratingsContainer .rating").clone(),c=$("#ratingsContainer .ratingCount").text().slice(1,-1);$(a).text("Average based on "+c+" customers "),$(a).appendTo("#userRating"),$(b).appendTo("#userRating")})},App.PDP.ReviewsController=new function(){$(document).ready(function(){var a=$("ul.reviewsList").find("li.review div.reviewBody"),b={extraChars:["&#8221;"]};Salmon.Global.TextTruncator(a,b)})},App.PDP.AddToBasketNew=new function(){var a=function(a){$.ajax({url:a,dataType:"json",success:b})},b=function(a){Salmon.Global.uiBlocker.unblockUI(),a&&($(document).trigger(Salmon.Global.CustomEvents.productAddedToBasket,a),"undefined"!=typeof a.errorMessage?Salmon.Global.Modal.openModal('<div class="error">'+a.errorMessage+"</div>","basketOverlay"):(Salmon.Global.Modal.openModal(a.recentlyAddedHtml,"basketOverlay"),$("#basketOverlay").find(".IORecsSlider").each(function(){new Salmon.Global.IORecSliders.IOSlider($(this),(!1),{ZoneID:"MBask_1",ProductID:Game.CurrentPage.PageInfo.ProductMediaID},function(){var a=$("#basketOverlay").find(".modalContent");a.css("top",($(window).height()-a.height())/2)}),cmDisplayRecs(),console.log(cmDisplayRecs())})))};$(document).on("click",".modalContent .CTAs a.btn.secondary",function(a){console.log("logging: con114"),a.preventDefault(),Salmon.Global.Modal.closeModal()}),$(document).on("click","a.addToBasket, button.addToBasket",function(b){b.preventDefault(),Salmon.Global.uiBlocker.blockUI();var c,d=$(this),e=d.parent();c=e.length>0&&e.hasClass("addToBasketForm")?e.find('input[name="addToShoppingCartAJAXURL"]').val()+"&"+e.serialize():d.attr("href"),a(c)}),$(document).on("click",".moreBuyingOptions .seeAll, .moreBuyingOptions .image a",function(a){console.log("logging: con137"),a.preventDefault(),$("html, body").animate({scrollTop:$(".section.buyingChoices").offset().top-45})})},App.PDP.MPItemPriceChange=new function(){$(document).ready(function(){$(document).on("click","#basketOverlay .CTAs.marketplace .keep a",function(a){console.log("logging: con149"),a.preventDefault(),$("#basketOverlay .mpStatus").slideToggle()})})},App.PDP.RewardPointsSidebar=new function(){$(document).ready(function(){0===$(".section.rewardPoints").length&&$("aside").addClass("noReward")})};var App=App||{};App.PDP=App.PDP||{},App.PDP.DeliveryCountdown=function(){var a,b=$(".section.deliveryCountdown"),c=Game.CurrentPage.CountDownInfo,d=function(a){var b=new Date,c=parseInt(a.split(":")[0]),d=parseInt(a.split(":")[1]);return b.setHours(c),b.setMinutes(d),b.setSeconds(0),b},e=function(b){var c=Date.parse(a)-Date.parse(b);return{total:c,hours:Math.floor(c/36e5%24),minutes:Math.floor(c/1e3/60%60)}},f=function(b,c,e){return a=d(c),e>d(b)&&e<a},g=function(){var b=a;return b.setHours(a.getHours()-parseInt(c.countDownDisplayBeforeTime)),new Date>b},h=function(){b.html('<p class="before">'+c.countDownBeforeMessage+"</p>")},i=function(a,d){var g=new Date;if(f(c.countDownStartTime,c.countDownCutoffTime,g)){var h=e(g),i=1==h.hours?"hour ":"hours ",j=1==h.minutes?"minute":"minutes";a.html("<span>"+h.hours+"</span> "+i),d.html("<span>"+h.minutes+"</span> "+j)}else b.hide()};return displayCountdown=function(){var a=$("<span />",{"class":"hours"}),d=$("<span />",{"class":"minutes"}),e=$("<span />",{"class":"time"}).append(a).append(d);b.html('<p class="after">'+c.countDownMessage+"</p>"),b.find("span").replaceWith(e),i(a,d),setInterval(function(){i(a,d)},6e4)},init=function(){c=Game.CurrentPage.CountDownInfo,g()?displayCountdown():h()},b.length>0&&"undefined"!=typeof Game.CurrentPage.CountDownInfo&&f(Game.CurrentPage.CountDownInfo.countDownStartTime,Game.CurrentPage.CountDownInfo.countDownCutoffTime,new Date)&&init(),{getTodayDateFromTime:d,isInBetweenTime:f}}(),App.PDP.MarketplaceTableFilteringViewModel=function(a){var b=function(a){var b=this;b.filters=[{title:"All",count:a.marketplaceItemsTotalCount,filter:null},{title:"New",count:a.marketplaceMintItemsCount,filter:function(a){return"Mint"==a.provenance}},{title:"Preowned",count:a.marketplacePreOwnedItemsCount,filter:function(a){return"PreOwned"==a.provenance}}],b.activeFilter=ko.observable(b.filters[0].filter),b.paginationPointer=ko.observable(1),b.totalFilteredAmount=ko.observable(),b.topAmountPaginated=ko.computed(function(){return b.paginationPointer()+2>b.totalFilteredAmount()?b.totalFilteredAmount():b.paginationPointer()+2}),b.selectedSortValue=ko.observable(),b.selectedSortValue.subscribe(function(b){var c;switch(b){case"price":c=function(a,b){return parseFloat(a.unitPrice)>parseFloat(b.unitPrice)?1:-1};break;case"price_delivery":c=function(a,b){return parseFloat(a.totalPrice)>parseFloat(b.totalPrice)?1:-1};break;case"reviews":c=function(a,b){return parseFloat(a.vendorNumberOfRatings)>parseFloat(b.vendorNumberOfRatings)?1:-1}}a.marketplaceItems.sort(c)}),b.hideNavigation=ko.computed(function(){return!(0===a.marketplaceMintItemsCount()||0===a.marketplacePreOwnedItemsCount())}),b.setActiveFilter=function(a,c){console.log("logging: mark55"),$(c.currentTarget).siblings(".current").removeClass("current"),$(c.currentTarget).addClass("current"),c.preventDefault(),b.paginationPointer(1),b.activeFilter(a.filter)},b.filteredItems=ko.computed(function(){var c;return c=b.activeFilter()?ko.utils.arrayFilter(a.marketplaceItems(),b.activeFilter()):a.marketplaceItems(),b.totalFilteredAmount(c.length),c.slice(b.paginationPointer()-1,b.paginationPointer()+2)})};return new b(a)},App.PDP.MarketplaceTableSellerDetailsViewModel=function(a){var b=function(a){var b,c=$(".sellerDetailsContainer"),d=this,e="/webapp/wcs/stores/servlet/m/AJAXMarketplaceSellerDeliveryDetails?msg=&vendorShopId=";d.detailsActive=ko.observable(!1),d.details=ko.observable({sellerName:"",sellerInfo:"",sellerShippingDetails:[]}),d.getSellerDetails=function(a,b){b.preventDefault();var c=a.vendorShopId;d.sendRequest(c)},d.sendRequest=function(a){$.get(e+a,function(a){var b,c=JSON.parse(a),d=JSON.parse(c.shipping);b='<div class="sellerDetails">',b+="<h2>"+c.supplier.name+"</h2>",b+='<div class="info">'+c.supplier.sellerInfo+"</div>",b+='<div class="shipping">';for(var e in d)b+='<div><div class="label">'+d[e].label+'</div><div class="region">'+d[e].region+"</div></div>";b+="</div>",b+="</div>",Salmon.Global.Modal.openModal(b,"sellerDetails")})},d.afterSellerDetailsUpdated=function(){"undefined"!=typeof b&&($("#marketplaceItemsList .sellerDetailsContainer").remove(),b.after(c.clone()))}};return new b(a)},App.PDP.BuyTabsViewModel=function(a,b){var c=function(a,b){var c=this,d=$("aside .section.buyingOptions .tabLinks"),e=d.find(".newLink"),f=d.find(".newTab"),g=$("aside .section.buyingOptions .tabs"),h=$("aside .section.buyingOptions .outOfStock"),i="undefined"!=typeof Game.CurrentPage.MarketplaceInfo&&!Game.CurrentPage.MarketplaceInfo.mintGameAvailable,j="undefined"!=typeof Game.CurrentPage.MarketplaceInfo&&!Game.CurrentPage.MarketplaceInfo.preownedGameAvailable,k="tabButtonTemplate",l="buyButtonsContainerTemplate",m=!1,n=function(a){console.log("logging: mark168");var b=$("<div />"),c=$("<div />");ko.applyBindingsToNode(b[0],{template:{name:k,data:a}}),ko.applyBindingsToNode(c[0],{template:{name:l,data:a}});var h=$(b.html().replace(/data-bind=".*"/g,"")),i=$(c.html().replace(/data-bind=".*"/g,""));h.addClass(a.condition.toLowerCase().replace("-","")+"Link"),i.addClass(a.condition.toLowerCase().replace("-","")+"Tab"),"Pre-owned"==a.condition&&e.length>0?(e.after(h),f.after(i)):"Pre-owned"==a.condition?(d.append(h),g.append(i)):(d.prepend(h),g.prepend(i)),b.remove(),c.remove()},o=function(a,b){return console.log("logging: mark195"),parseFloat(a.totalPrice)>parseFloat(b.totalPrice)?1:-1};if(c.mintItems=ko.observableArray("undefined"!=typeof b&&""!==b?a.marketplaceData.mintItems.filter(function(a){return a.vendorShopId==b}):a.marketplaceData.mintItems),c.preOwnedItems=ko.observableArray("undefined"!=typeof b&&""!==b?a.marketplaceData.preOwnedItems.filter(function(a){return a.vendorShopId==b}):a.marketplaceData.preOwnedItems),c.mintItems.sort(o),c.preOwnedItems.sort(o),c.promotedItems=ko.observableArray(),i&&c.mintItems().length>0){var p=c.mintItems()[0],q={condition:"New",price:"&pound;"+a.processPrice(p.unitPrice),vendorShopName:p.vendorShopName,addToBasketUrl:a.generateAddToBasketUrl(p),addToWishlistUrl:a.generateAddToWishlistUrl(p)};m=!0,n(q),h.hide(),c.mintItems.shift()}if(j&&c.preOwnedItems().length>0){console.log("logging: mark225");var r=c.preOwnedItems()[0],q={condition:"Pre-owned",price:"&pound;"+a.processPrice(r.unitPrice),vendorShopName:r.vendorShopName,addToBasketUrl:a.generateAddToBasketUrl(r),addToWishlistUrl:a.generateAddToWishlistUrl(r)};m=!0,n(q),h.hide(),c.preOwnedItems.shift()}m&&(d.find(".current").removeClass("current"),d.find("li").eq(0).addClass("current"),g.find(".current").removeClass("current"),g.find("> div").eq(0).addClass("current")),c.promotedItems(c.mintItems().concat(c.preOwnedItems())),c.promotedItems().length>0?(ko.applyBindings({promotedItems:c.promotedItems().slice(0,3),master:a},$("aside .section.moreBuyingOptions")[0]),$("aside .section.moreBuyingOptions").show()):$("aside .section.moreBuyingOptions").hide()};return new c(a,b)},App.PDP.MarketplaceViewModel=function(a){var b=function(a){var b=this;b.marketplaceData=ko.observableArray(),b.marketplaceItems=ko.observableArray(),b.marketplaceMintItemsCount=ko.observable(),b.marketplacePreOwnedItemsCount=ko.observable(),b.marketplaceLowestPrice=ko.observable(),b.marketplaceItemsTotalCount=ko.computed(function(){return b.marketplaceMintItemsCount()+b.marketplacePreOwnedItemsCount()}),b.promotedItems=ko.observableArray(),b.sellerDetails=new App.PDP.MarketplaceTableSellerDetailsViewModel(b),b.Filtering=new App.PDP.MarketplaceTableFilteringViewModel(b),b.processDeliveryPrice=function(a){return 0!==parseFloat(a)?"Delivery from Â£"+parseFloat(a).toFixed(2):"Free delivery"},b.processPrice=function(a){return parseFloat(a).toFixed(2)},b.processRatingClass=function(a){return"rating"+a},b.processCondition=function(a){return console.log("logging: mark327"),"PreOwned"==a?"Pre-owned":a},b.generateAddToBasketUrl=function(b){console.log("logging: mark332");var c=["vendorOfferId","catEntryId_1","productId_1","unitPrice","partNumber"],d="";b.catEntryId&&(b.catEntryId_1=b.catEntryId,b.productId_1=b.catEntryId_1);for(var e in c){var f=c[e];d+="&"+f+"="+b[f]}return a.addToBasketUrl+a.addToBasketUrlParams+d},b.generateVendorUrl=function(b){return a.vendorUrl+b},b.generateThumbnailSrc=function(a){return Salmon.Global.PageContext.MARKETPLACE_SELLER_LOGO_URL_SMALL+"/"+a+".png"},b.generateAddToWishlistUrl=function(b){return console.log("logging: mark360"),a.addToWishlistUrl+a.addToWishlistUrlParams+"&catEntryId="+b.catEntryId},b.getLowestPrice=function(){var a=9999,c=b.marketplaceItems();for(var d in c)c[d].unitPrice<a&&(a=c[d].unitPrice);return a},b.getMarketplaceData=function(){if("undefined"!=typeof Game.CurrentPage.PageInfo.ProductID){var c=Game.CurrentPage.MarketplaceInfo,d="undefined"!=typeof $("body").data("vendorid")?$("body").data("vendorid"):"";c.productId=Game.CurrentPage.PageInfo.ProductID,$.get(a.marketplaceRequestUrl,c,function(a){return b.marketplaceData=JSON.parse(a),"undefined"!=typeof b.marketplaceData.errorCode?void console.log("Marketplace is not available"):(b.marketplaceMintItemsCount(b.marketplaceData.mintItems.length),b.marketplacePreOwnedItemsCount(b.marketplaceData.preOwnedItems.length),b.marketplaceItems(b.marketplaceData.mintItems.concat(b.marketplaceData.preOwnedItems)),b.marketplaceItems.sort(function(a,b){return parseFloat(a.unitPrice)>parseFloat(b.unitPrice)?1:-1}),""!==d&&(b.marketplaceItems(b.marketplaceItems().filter(function(a){return a.vendorShopId==d})),(1==b.marketplaceItems().length||1==b.marketplaceMintItemsCount()&&1==b.marketplacePreOwnedItemsCount())&&b.marketplaceItems([])),ko.applyBindings(new App.PDP.BuyTabsViewModel(b,d),$("aside .section.buyingOptions")[0]),b.marketplaceLowestPrice(b.getLowestPrice()),void 0)})}},b.getMarketplaceData()};return new b(a)},App.PDP.Marketplace=function(){"use strict";var a={marketplaceRequestUrl:"/webapp/wcs/stores/servlet/MarketplaceSupplierItemsInterface",addToBasketUrl:"/webapp/wcs/stores/servlet/OrderChangeServiceItemAdd",addToBasketUrlParams:"?errorViewName=AjaxActionErrorResponse&quantity=1&page=pdpPage&updateable=0&URL=AjaxMiniShoppingBagView&storeId="+Game.Global.Vars.storeId+"&langId="+Game.Global.Vars.langId+"&catalogId="+Game.Global.Vars.catalogId,addToWishlistUrl:"/webapp/wcs/stores/servlet/InterestItemAddMobile",addToWishlistUrlParams:"?catalogId=10201&categoryId=&langId=44&storeId=10151&mobileFlag=true&URL=",vendorUrl:"/webapp/wcs/stores/servlet/MarketplaceSellerDetailsView?catalogId="+Game.Global.Vars.catalogId+"&langId="+Game.Global.Vars.langId+"&storeId="+Game.Global.Vars.storeId+"&URL=mMarketplaceSellerDetailsView&vendorShopId=",isSafari:/^((?!chrome).)*safari/i.test(navigator.userAgent)},b=new function(){this.buyOptionsSection=$("aside .section.buyingOptions"),this.marketplaceTable=$("#marketplaceTable")},c=function(){var a=b.buyOptionsSection.find(".tabLinks li"),c=b.buyOptionsSection.find(".tabs > div"),d=function(d){b.buyOptionsSection.find(".tabLinks li.current").removeClass("current"),b.buyOptionsSection.find(".tabs > .current").removeClass("current"),isNaN(d)?(c.filter("."+d+"Tab").addClass("current"),a.filter("."+d+"Link").addClass("current")):(c.eq(d).addClass("current"),a.eq(d).addClass("current"))},e=document.location.hash;if($(document).on("click",".buyingOptions .tabLinks li",function(){a=b.buyOptionsSection.find(".tabLinks li"),c=b.buyOptionsSection.find(".tabs > div");var e=$.inArray(this,b.buyOptionsSection.find(".tabLinks li"));d(e)}),e)switch(e){case"#preowned":d("preowned");break;case"#new":d("new");break;case"#download":d("download")}else 0===$(".buyingOptions .tabLinks li.current").length&&(a.eq(0).addClass("current"),c.eq(0).addClass("current"))},d=function(d){a=$.extend({},a,d),a.$elements=b,ko.applyBindings(App.PDP.MarketplaceViewModel(a),b.marketplaceTable[0]),c()};Game&&"pdp"===Game.CurrentPage.PageName&&d()}(),$(document).ready(function(){if(Game.featureToggles.NewHeaderAndFooter){new Salmon.Global.SimpleSlider.newSlider({autoScroll:!1,resizeSlides:!1,slidesToFit:2,elements:{sliderContainer:".thumbSliderContainer"}})}if(Game.featureToggles.NewHeaderAndFooter){var a,b=$(".thumbSlider ul li"),c=(b.find("img"),b.find("a"),'<iframe width="640" height="320" type="text/html" src="//link.videoplatform.limelight.com/media/?mediaId=%mediaId%&showInlinePlaylistOnLoad=false&width=620&height=300" frameborder="0" allowfullscreen="true" ></iframe>'),d=function(a){var c=$(".modal.opened"),d=b.eq(a).find("a").attr("href"),e='<img src="'+d+'"/>';c.find("img").remove(),c.find("iframe").remove(),c.find(".modalContent").append(e)},e=function(a){var c=$(".modal.opened"),d=b.eq(a).attr("data-youtubeid"),e=b.eq(a).hasClass("list");if(e)var f='<iframe width="420" height="315" src="//www.youtube.com/embed/videoseries?list='+d+'"  frameborder="0" allowfullscreen></iframe>';else var f='<iframe width="420" height="315" src="//www.youtube.com/embed/'+d+'"></iframe>';c.find("img").remove(),c.find("iframe").remove(),c.find(".modalContent").append(f)},f=function(a){var d=$(".modal.opened"),e=b.eq(a).attr("limelightid"),f=c.replace("%mediaId%",e);d.find("img").remove(),d.find("iframe").remove(),d.find(".modalContent").append(f)},g=function(c){var g=c;"-1"==c&&(g=b.length-1,a=b.length),c>=b.length&&(g=0,a=0),b.eq(c).hasClass("youtube")?e(g):b.eq(c).hasClass("limelight")?f(g):d(g)};$(document).on("click",".modal.opened .arrow",function(){$(this).hasClass("next")?a+=1:a-=1,b.length>1&&g(a)}),b.bind("click",function(d){d.preventDefault();var e,f,g=$(this),h="",i='<span class="arrow prev '+h+'">&nbsp;</span><span class="arrow next">&nbsp;</span>',j=function(){Salmon.Global.Modal.openModal(f,"screenshotsModal",!0)};if(1==b.length&&(h="inactive"),g.hasClass("youtube")||g.hasClass("youtubelist")){e=g.attr("data-youtubeid");var k=g.hasClass("list");f=k?i+'<iframe width="420" height="315" src="//www.youtube.com/embed/videoseries?list='+e+'"  frameborder="0" allowfullscreen></iframe>':i+'<iframe width="420" height="315" src="//www.youtube.com/embed/'+e+'"></iframe>',j()}else g.hasClass("limelight")?(e=g.attr("limelightid"),f=i+c.replace("%mediaId%",e),j()):(e=g.find("a").attr("href"),f=i+'<img src="'+e+'"/>',$(f).load(function(){j()}));a=$.inArray(g[0],b)}),$("body").find(".scrollContent").each(function(){var a=$(this),b=a.width();if(a.find("img")){var c=a.find("img").first();c.on("load",function(){var d=c.height(),e=c.width();a.css("height",d+40),e>b&&(c.width="100%")})}else a.css("height","160px")})}});var App=App||{};App.PDP=App.PDP||{},App.PDP.Reviews=new function(){function a(){o&&App.Global.Pluck.Check()&&document.getElementById("userReviews")&&(s=new PluckSDK.ExternalResourceKey,s.Key=o.getAttribute("rel"),b())}function b(){PluckSDK.SendRequests([new PluckSDK.UserRequest],c)}function c(a){a.length>0?t=a[0].User:t.IsAnonymous=!0,d(w)}function d(a){var b=new PluckSDK.ReviewsPageRequest;a>1?b.ItemsPerPage=A.resultsAjaxLoad:b.ItemsPerPage=A.resultsPageLoad,b.OneBasedOnPage=a,b.ReviewedKey=s,b.SortType=new PluckSDK.ReviewRatingSort({SortOrder:"Descending"}),PluckSDK.SendRequests([b],e)}function e(a){if(a.length>0)if(a[0].Items.length>0){var b=new App.PDP.Carousel;$("#userReviews > p").remove(),w=a[0].OneBasedOnPage+a[0].ItemsPerPage-1,v=a[0].TotalItems,x=a[0].SortType.ObjectType,y=a[0].SortType.SortOrder;for(var c=0;c<a[0].Items.length;c++)new App.PDP.Reviews.Review(q,a[0].Items[c],{pluckUser:t,parentKey:s});B===!1?(h(),b.setUpCarousels([o]),B=!0):b.addCarouselItem(o),v>a[0].ItemsPerPage?f(v):g(a)}else i()}function f(a){var b=new PluckSDK.ReviewsPageRequest;b.ItemsPerPage=a,b.OneBasedOnPage=1,b.ReviewedKey=s,PluckSDK.SendRequests([b],g)}function g(a){if(a.length>0){for(var b=0;b<a[0].Items.length;b++){var c=a[0].Items[b];z["RATING_"+c.Rating]=z["RATING_"+c.Rating]+1,c.ReviewedBy.UserKey.Key===t.UserKey.Key&&(u=!0)}i()}}function h(){var a=$(App.PDP.Reviews.Template.PAGINATION_CONTROLS),b=a.find("div.next"),c=a.find("div.previous");(v<=5||w==v)&&$(b).addClass("disabled"),$(c).append($(document.createElement("a")).attr("href","#").text("Prev")),$(b).append($(document.createElement("a")).attr("href","#").text("Next").bind("click",function(){return w<v&&d(w+1),w<v-1?$(b).addClass("enabled"):$(b).removeClass("enabled"),!1})),$("#userReviews > .header").after(a)}function i(){r.empty(),t.IsAnonymous?j():(k(),l())}function j(){r.append(App.PDP.Reviews.Template.REGISTER)}function k(){r.append(App.PDP.Reviews.TemplateNew.FORM_TOGGLE),$(".toggleReviewForm").bind("click",function(){$(".reviewWrite").find(".write").slideToggle()})}function l(){if(!u){var a=Salmon.Global.FeatureToggles.getFeature("NewHeaderAndFooter")?$(App.PDP.Reviews.TemplateNew.WRITE_REVIEW):$(App.PDP.Reviews.Template.WRITE_REVIEW);m(a.find("div.rating")),a.find("textarea").bind("focus",function(){this.value===Salmon.Global.StoreText.pluck.review.WRITE_REVIEW_BODY_TEXT&&(this.value="")}).bind("blur",function(){""===$.trim(this.value)?this.value=Salmon.Global.StoreText.pluck.review.WRITE_REVIEW_BODY_TEXT:($("#reviewErrorSummary").find("ul").find("li").find("a[href*='#writeReviewBody']").parent().remove(),clearErrorSumary())}),a.find("#writeReviewTitle").bind("blur",function(){""===$.trim(this.value)||($("#reviewErrorSummary").find("ul").find("li").find("a[href*='#writeReviewTitle']").parent().remove(),clearErrorSumary())});var b=a.find("form"),c=b.get(0);if(c){var d=new Adoro.FormValidator(c);d.addValidator("writeReviewRating",[{method:function(){var a=document.getElementById("writeReviewRating").value;return 0===a?(document.getElementById("reviewStar").style.border="2px solid red",!1):(document.getElementById("reviewStar").style.border="",!0)},messages:["Required","Please choose your review stars, at least one star.</br>(* Poor, ** Average, *** Good, **** Very Good, ***** Excellent)"]}]),d.addValidator("writeReviewTitle",[{method:Adoro.FormRules.notEmpty,messages:["Required","Please enter a title for your review"]}]),App.Global.Forms.Validation.Helpers.createBasicField(d,b,"writeReviewTitle"),d.addValidator("writeReviewBody",[{method:Adoro.FormRules.notEmpty,messages:["Required","Please enter your review"]},{method:Adoro.FormRules.notEqual,messages:["Required","Please enter your review"],params:{compareValue:Salmon.Global.StoreText.pluck.review.WRITE_REVIEW_BODY_TEXT}}]),App.Global.Forms.Validation.Helpers.createBasicField(d,b,"writeReviewBody"),d.addEventHandler("onFormValidateStart",function(){App.Global.Forms.Validation.Helpers.clearErrorSummary($("#reviewErrorSummary"))}),d.addEventHandler("onFormFail",function(a,b,c){App.Global.Forms.Validation.Helpers.generateErrorSummary($("#reviewErrorSummary"),c)}),b.bind("submit",function(a){if(a.preventDefault(),d.validate()){var b=new PluckSDK.ReviewActionRequest;b.ReviewedKey=s,b.ReviewTitle=document.getElementById("writeReviewTitle").value,b.ReviewBody=document.getElementById("writeReviewBody").value,b.OnPageUrl=location.href+"#userReviews",b.OnPageTitle=document.getElementById("productName").innerHTML.replace(/^\s*/,"").replace(/\s*$/,""),b.ReviewRating=parseInt(document.getElementById("writeReviewRating").value,10),PluckSDK.SendRequests([b],n)}})}r.append(a)}}function m(a){for(var b=0;b<5;b++)a.append($(document.createElement("span")).addClass("rate").text(b+1));a.css("cursor","pointer"),a.find("span").bind("mouseover",function(){var a=$(this),b=parseInt(a.text(),10);isNaN(b)||a.parent().removeClass("setRating0 setRating1 setRating2 setRating3 setRating4 setRating5").addClass("setRating"+b)}).bind("click",function(){var b=$(this),c=parseInt(b.text(),10);isNaN(c)||a.find("input[name='writeReviewRating']").val(c),document.getElementById("reviewStar").style.border="",$("#reviewErrorSummary").find("ul").find("li").find("a[href*='#writeReviewRating']").parent().remove(),clearErrorSumary()}),a.bind("mouseleave",function(){$(this).removeClass("setRating1 setRating2 setRating3 setRating4 setRating5"),$(this).addClass("setRating"+$(this).find("input[name='writeReviewRating']").val())})}function n(a){a.length>0&&("ProcessingException"===a[0].ResponseStatus.StatusCode&&"DirtyWordFilterTriggered"===a[0].Exceptions[0].ExceptionCode?r.find("div.reviewFilter").find("span.reviewFiltered").text("Please edit or remove the following word(s), then resubmit your content: "+a[0].Exceptions[0].Value+"."):(r.remove(),$(".sUserReviews.header").append('<span class="success">Thank you! Your review was added!</span>')))}var o=document.getElementById("userReviews")||null;if(o){var p=$(o),q=p.find("ul.reviewsList"),r=(p.find("div.reviewsControl"),p.find("div.reviewWrite")),s=null,t={},u=!1,v=0,w=1,x="",y="",z={RATING_5:0,RATING_4:0,RATING_3:0,RATING_2:0,RATING_1:0},A={resultsPageLoad:5,resultsAjaxLoad:1},B=!1;a()}},App.PDP.Reviews.Review=function(a,b,c){function d(){$.extend(s,c),r=s.pluckUser,t.find("div.reviewerPhoto").append($(document.createElement("img")).attr({src:B,alt:A})),t.find("p.reviewerName").append(A),t.find("p.reviewDate").text(C),t.find("p.reviewTitle").text(D),t.find("span.reviewRating").addClass("rating rating"+E),t.find("p.reviewBody").html(F),t.find("p.moreLink a").bind("click",e),u.find("li.writeAComment a").bind("click",e),q.append(t)}function e(a){var c=document.createElement("div"),d=document.createElement("ul"),e=null;new App.PDP.Reviews.Review(d,b,e),h(b),c.appendChild(d),c.style.width="862px",Adoro.Dialogue.setHtml(c),Adoro.Dialogue.showDialogue({closeOnOverlayClick:!0}),a.preventDefault(),r.IsAnonymous||r.UserKey.Key===z?r.IsAnonymous||(u=$(d).find("div.reviewTools").append(App.PDP.Reviews.Template.REVIEW_TOOLS),v=u.find("li.writeAComment a"),u.find("li.recommend a").remove(),u.find("li.report a").remove(),u.find("li.follow a").remove()):(u=$(d).find("div.reviewTools").append(App.PDP.Reviews.Template.REVIEW_TOOLS),v=u.find("li.writeAComment a"),w=u.find("li.recommend a"),x=u.find("li.report a"),y=u.find("li.follow a"),s.parentKey&&(b.ItemScore.CurrentUserHasScored?w.replaceWith(Salmon.Global.StoreText.pluck.review.RECOMMENDED):w.bind("click",j),b.AbuseCounts.CurrentUserHasReportedAbuse?x.replaceWith(Salmon.Global.StoreText.pluck.review.REPORTED):x.bind("click",n)),b.ReviewedBy.FriendshipStatus.IsFriend?y.replaceWith(Salmon.Global.StoreText.pluck.controls.user.FRIEND):y.bind("click",l),v.unbind("click").bind("click",f))}function f(){for(var a=$(App.PDP.Reviews.Template.WRITE_COMMENT),c=a.find("textarea"),d=a.find("input[type='submit']"),e=document.getElementById("userReviews"),f=this;f.parentNode.className.indexOf("item")==-1;)f=f.parentNode;return f.parentNode.appendChild(a[0]),c.focus(),d.bind("click",function(){if(""!==c.val()){var a=new PluckSDK.CommentActionRequest;a.Body=c.val(),a.Categories=[new PluckSDK.DiscoveryCategory({Name:"games"})],a.CommentedOnKey=b.ReviewKey,a.OnPageUrl=location.href+"#userReviews",a.OnPageTitle=e.getAttribute("title"),PluckSDK.SendRequests([a],g)}}),!1}function g(a){a.length>0&&("OK"===a[0].ResponseStatus.StatusCode?($("#dialogue").find("li.review").find("div.writeComment").remove(),h(b)):"ProcessingException"===a[0].ResponseStatus.StatusCode&&"DirtyWordFilterTriggered"===a[0].Exceptions[0].ExceptionCode&&$("#dialogue").find("li.review").find("div.writeComment").find("div.commentFilter").find("span.commentFiltered").text("Please edit or remove the following word(s), then resubmit your content: "+a[0].Exceptions[0].Value+"."))}function h(a){var b=new PluckSDK.CommentsPageRequest;b.CommentedOnKey=a.ReviewKey,b.OneBasedOnPage=1,b.ItemsPerPage=1e3,PluckSDK.SendRequests([b],i)}function i(a){if(a&&a.length>0&&a[0].Items.length>0){var b=$("#dialogue").find(".comments")[0];$(b).empty();for(var c=0;c<a[0].Items.length;c++)new App.Global.Pluck.Comment(b,a[0].Items[c],{nestedComments:!1})}}function j(){var a=new PluckSDK.SetItemScoreActionRequest;return a.ParentKey=s.parentKey,a.Score=1,a.ScoreId="Review",a.TargetKey=b.ReviewKey,PluckSDK.SendRequests([a],k),!1}function k(a){a.length>0&&"OK"===a[0].ResponseStatus.StatusCode&&w.replaceWith(Salmon.Global.StoreText.pluck.review.RECOMMENDED)}function l(){var a=new PluckSDK.AddFriendActionRequest;a.FriendUserKey=b.ReviewedBy.UserKey;var c=new PluckSDK.UserRequest;return c.UserKey=b.ReviewedBy.UserKey,PluckSDK.SendRequests([a,c],m),!1}function m(a){if(a.length>1&&"OK"===a[0].ResponseStatus.StatusCode&&"OK"===a[1].ResponseStatus.StatusCode){var b=a[1].User||null;b&&(b.FriendshipStatus.IsPendingFriend?y.replaceWith(Salmon.Global.StoreText.pluck.controls.user.FRIENDSHIP_REQUESTED):b.FriendshipStatus.IsFriend&&y.replaceWith(Salmon.Global.StoreText.pluck.controls.user.FRIEND))}}function n(){for(var a=$(App.PDP.Reviews.Template.REVIEW_REPORT),b=Salmon.Global.StoreText.pluck.review.REPORT_OPTIONS.split(","),c=0;c<b.length;c++)a.append($(document.createElement("option")).attr("value",b[c]).text(b[c]));return a.focus(),a.bind("change",o),x.replaceWith(a),!1}function o(){var a=new PluckSDK.ReportAbuseActionRequest;a.AbuseOnKey=b.ReviewKey,a.Reason=this.value,
PluckSDK.SendRequests([a],p)}function p(a){a.length>0&&"OK"===a[0].ResponseStatus.StatusCode&&u.find("li.report select").replaceWith(Salmon.Global.StoreText.pluck.review.REPORTED)}var q=$(a),r={},s={parentKey:null,pluckUser:{IsAnonymous:!0}},t=Salmon.Global.FeatureToggles.getFeature("NewHeaderAndFooter")?$(App.PDP.Reviews.TemplateNew.REVIEW_ITEM):$(App.PDP.Reviews.Template.REVIEW_ITEM),u=$(App.PDP.Reviews.Template.REVIEW_TOOLS),v=null,w=null,x=null,y=null,z=b.ReviewedBy.UserKey.Key,A=b.ReviewedBy.DisplayName,B=b.ReviewedBy.AvatarPhotoUrl,C=App.Global.Pluck.TimeDifference(b.DatePosted),D=b.Title,E=Math.floor(b.Rating),F=b.Body;d()},App.PDP.Reviews.Template={REGISTER:'<a class="register" href="'+Salmon.Global.PageContext.LOGON_FORM_URL+window.location.protocol+"//"+window.location.host+window.location.pathname+'?activeTab=userReviews&shouldCachePage=false"><span>'+Salmon.Global.StoreText.pluck.review.REGISTER_TO_WRITE_A_REVIEW+"</span></a>",WRITE_REVIEW:'<div class="write"><form><div id="reviewErrorSummary" class="errorSummary hide"></div><div id="reviewStar" class="rating rating0"><input id="writeReviewRating" name="writeReviewRating" value="0" /></div><div class="field"><div class="indicator"><label for="writeReviewTitle">'+Salmon.Global.StoreText.pluck.review.WRITE_REVIEW_TITLE_LABEL+'</label></div><div class="element"><div class="elementWrapper"><input class="text" id="writeReviewTitle" name="writeReviewTitle" maxlength="100" /></div></div></div><div class="field"><div class="indicator"><label for="writeReviewBody">'+Salmon.Global.StoreText.pluck.review.WRITE_REVIEW_BODY_LABEL+'</label></div><div class="element"><div class="elementWrapper"><textarea name="writeReviewBody" id="writeReviewBody">'+Salmon.Global.StoreText.pluck.review.WRITE_REVIEW_BODY_TEXT+'</textarea></div></div></div><div class="reviewFilter"><span class="reviewFiltered" style="color:red"></span></div><ul class="action"><li class="secondary"><input type="submit" class="update" id="submitReview" name="submitReview" value="'+Salmon.Global.StoreText.pluck.review.SUBMIT_REVIEW+'"/></li></ul></form></div>',WRITE_COMMENT:'<div class="writeComment"><div class="field"><div class="element"><div class="elementWrapper"><textarea id="addComment" name="addComment"></textarea></div></div></div><div class="commentFilter"><span class="commentFiltered" style="color:red"></span></div><ul class="action"><li class="secondary"><input type="submit" class="update" id="submitComment" name="submitComment" value="'+Salmon.Global.StoreText.pluck.review.SUBMIT_COMMENT+'" /></li></ul></div>',REVIEW_ITEM:'<li class="item review"><div class="reviewContent"><p class="reviewTitle"></p><span class="reviewRating"></span><p class="reviewBody"></p><p class="moreLink"><a href="#">See more &#8230;</a></p></div><div class="reviewInfo"><p class="reviewerName"></p><div class="reviewerPhoto"></div><div class="reviewerInfo"><p class="reviewDate"></p><div class="reviewTools"></div></div></div><div class="comments"></div></li>',REVIEW_TOOLS:'<ul class="tools"><li class="recommend toolLike"><a href="#recommend">'+Salmon.Global.StoreText.pluck.review.RECOMMEND+'</a></li><li class="follow toolPlus"><a href="#follow">'+Salmon.Global.StoreText.pluck.controls.user.ADD_AS_FRIEND+'</a></li><li class="report toolWarn"><a href="#report">'+Salmon.Global.StoreText.pluck.review.REPORT+'</a></li><li class="writeAComment"><a href="#writeComment">'+Salmon.Global.StoreText.pluck.review.WRITE_A_COMMENT+"</a></li></ul>",REVIEW_REPORT:'<select name="report"><option value="">'+Salmon.Global.StoreText.pluck.review.REPORT_LABEL+"</option></select>",PAGINATION_CONTROLS:'<div class="pagination"><div class="previous disabled"></div><div class="next"></div></div>'},App.PDP.Reviews.TemplateNew={FORM_TOGGLE:'<button class="btn secondary toggleReviewForm">'+Salmon.Global.StoreText.pluck.review.WRITE_REVIEW_BODY_LABEL+"</button>",REGISTER:'<a class="register" href="'+Salmon.Global.PageContext.LOGON_FORM_URL+window.location.protocol+"//"+window.location.host+window.location.pathname+'?activeTab=userReviews&shouldCachePage=false"><span>'+Salmon.Global.StoreText.pluck.review.REGISTER_TO_WRITE_A_REVIEW+"</span></a>",WRITE_REVIEW:'<div class="write"><form><div id="reviewErrorSummary" class="errorSummary hide"></div><div class="writeReviewScore"><label for="writeReviewTitle"><span>'+Salmon.Global.StoreText.pluck.review.WRITE_REVIEW_TITLE_LABEL+'</span><input class="text" id="writeReviewTitle" name="writeReviewTitle" maxlength="100" type="text" placeholder="'+Salmon.Global.StoreText.pluck.review.WRITE_REVIEW_TITLE_LABEL+'" /></label><div id="reviewStar" class="rating rating0"><input id="writeReviewRating" name="writeReviewRating" value="0" type="number" /></div></div><label for="writeReviewBody"><span>'+Salmon.Global.StoreText.pluck.review.WRITE_REVIEW_BODY_LABEL+'</span><textarea name="writeReviewBody" id="writeReviewBody">'+Salmon.Global.StoreText.pluck.review.WRITE_REVIEW_BODY_TEXT+'</textarea></label><div class="reviewFilter"><span class="reviewFiltered" style="color:red"></span></div><input type="submit" class="update" id="submitReview" name="submitReview" value="'+Salmon.Global.StoreText.pluck.review.SUBMIT_REVIEW+'"/></form></div>',WRITE_COMMENT:'<div class="writeComment"><div class="field"><div class="element"><div class="elementWrapper"><textarea id="addComment" name="addComment"></textarea></div></div></div><div class="commentFilter"><span class="commentFiltered" style="color:red"></span></div><ul class="action"><li class="secondary"><input type="submit" class="update" id="submitComment" name="submitComment" value="'+Salmon.Global.StoreText.pluck.review.SUBMIT_COMMENT+'" /></li></ul></div>',REVIEW_ITEM:'<li class="item review"><div class="reviewContent"><p class="reviewTitle"></p><span class="reviewRating"></span><div class="reviewInfo"><p class="reviewerName"></p><div class="reviewerPhoto"></div><div class="reviewerInfo"><p class="reviewDate"></p><div class="reviewTools"></div></div></div><p class="reviewBody"></p><p class="moreLink"><a href="#">See more &#8230;</a></p></div><div class="comments"></div></li>',REVIEW_TOOLS:'<ul class="tools"><li class="recommend toolLike"><a href="#recommend">'+Salmon.Global.StoreText.pluck.review.RECOMMEND+'</a></li><li class="follow toolPlus"><a href="#follow">'+Salmon.Global.StoreText.pluck.controls.user.ADD_AS_FRIEND+'</a></li><li class="report toolWarn"><a href="#report">'+Salmon.Global.StoreText.pluck.review.REPORT+'</a></li><li class="writeAComment"><a href="#writeComment">'+Salmon.Global.StoreText.pluck.review.WRITE_A_COMMENT+"</a></li></ul>",REVIEW_REPORT:'<select name="report"><option value="">'+Salmon.Global.StoreText.pluck.review.REPORT_LABEL+"</option></select>",PAGINATION_CONTROLS:'<div class="pagination"><div class="previous disabled"></div><div class="next"></div></div>'};var App=App||{};App.PDP=App.PDP||{},App.PDP.WishlistOptions=new function(){function init(){if(options=document.getElementById("wishlistOptions")||null){$options=$(options).addClass("jsWishlistOptions");var a=$options.find("form"),b=$options.find("input[name='addToWishListAJAXURL']").get(0),c=b?$(b).val():null;c&&$options.find("form").bind("submit",function(a){a.preventDefault(),$.ajax({url:c,data:$(this).serialize(),dataType:"json",success:function(a){new App.PDP.CrossSellSwitcher(a),a.coremetrics&&callCoremetrics(a.coremetrics)},complete:function(){Adoro.Dialogue.hideDialogue()}})});var d=a.length>1;if(d)$options.bind("click",function(a){return position.left=a.pageX,position.top=a.pageY,showDialogue(),!1});else{var e=$options.find("form:first").find("input[type='submit']").bind("click",function(a){a.stopPropagation()});$options.bind("click",function(){e.trigger("click")})}}}function showDialogue(){Adoro.Dialogue.setHtml($options.find("div.wishlistWrapper").clone(!0).get(0)),Adoro.Dialogue.showDialogue({closeOnOverlayClick:!0,overlayOpacity:"0.5",x:position.left,y:position.top-Adoro.Dialogue.getDimensions().h,container:document.getElementById("content")})}function callCoremetrics(script){for(var $script=$(script),i=0;i<$script.length;i++)if($script[i].innerHTML){var scriptHtml=$script[i].innerHTML.replace("<!--","").replace("//-->","").replace(/^\s*/,"").replace(/\s*$/,"");0!==scriptHtml.indexOf("cmSet")&&eval(scriptHtml)}}var options=null,$options=null,position={};$(init)};
//# sourceMappingURL=pdp.min.js.map